package volter.com.example.chatbot;

import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;

import java.sql.*;

public class ChatbotController {

    @FXML
    private TextArea chatArea;

    @FXML
    private TextField userInput;

    @FXML
    private Button sendButton;

    @FXML
    private Button clearButton;


    private Connection connection;

    @FXML
    public void initialize() {
        String url="jdbc:mysql://localhost:3306/chatbotdb";
        String user="root";
        String password="24074209190344";

        try {
            connection = DriverManager.getConnection(url,user,password);
        } catch (SQLException e) {
            e.printStackTrace();
            chatArea.appendText("Error: Could not connect to database.\n");
        }

        sendButton.setOnAction(e -> handleSend());
    }

    private void handleSend() {
        String keyword = userInput.getText().toLowerCase();
        String response = findResponse(keyword);

        chatArea.appendText("You: " + keyword + "\n");
        chatArea.appendText("Bot: " + response + "\n\n");
        chatArea.setScrollTop(Double.MAX_VALUE);
        clearButton.setOnAction(e -> chatArea.clear());
        userInput.clear();
    }

    private String findResponse(String keyword) {
        String query = "SELECT response FROM chatbot WHERE keyword = ?";
        try {
            PreparedStatement statement = connection.prepareStatement(query);
            statement.setString(1, keyword);
            ResultSet result = statement.executeQuery();

            if (result.next()) {
                return result.getString("response");
            }
        } catch (SQLException e) {
            e.getMessage();
        }

        return "I think you typed a wrong keyword.";
    }
}
